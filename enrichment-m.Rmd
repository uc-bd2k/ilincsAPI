---
title: "iLINCS API R Notebook"
output:
  html_document:
    df_print: paged
  html_notebook: default
  word_document: default
  pdf_document: default
---

<!-- ## Prerequisites  -->

```{r include = FALSE}
library(knitr)
library(tinytex)
library(httr)
library(jsonlite)
library(plotly)
library(htmltools)

```

#Selecting a signature to analyze

```{r selectedSignature}
ilincs_signatureId <- "LINCSCP_100"
ilincs_signatureId
```

## Getting signature data and vulcano plot
#The first step is to retrieve the session id for creation of the signature data table
```{r}
req <- POST("http://www.ilincs.org/api/ilincsR/downloadSignature", body = list(sigID = paste(ilincs_signatureId)), encode = "json")
ilincs_sessionId<-unlist(content(req))
ilincs_sessionId
```

# Retrieving data
```{r}
fileUrl=paste("http://www.ilincs.org/tmp/",ilincs_sessionId,".xls",sep="")
signatureData<-read.table(fileUrl,sep="\t",header=T,stringsAsFactors = F)
head(signatureData)
```
##Find enriched signatures
```{r}
glist<-paste(signatureData[order(signatureData$Significance_pvalue)[1:100],"Name_GeneSymbol"],collapse = ",")
glist

```{r}
apiUrl <- "http://www.ilincs.org/api/ilincsR/GeneListEnrichment"
req <- POST(apiUrl, body = list(geneList=glist, libName="LIB_5"), encode = "form")
connectedSignatures <- data.table::rbindlist(content(req), use.names = TRUE, fill = TRUE)

head(connectedSignatures)
```
